# KToolBox Translation CI Usage Guide

This document explains how to use the newly implemented translation CI for KToolBox documentation.

## Overview

The translation system automatically translates API documentation generated by mkdocstrings from English to Chinese using the MyMemory translation API. It includes caching, rate limiting, and automatic Git commits.

## How to Use

### Manual Translation

1. **Trigger the Translation Workflow**:
   - Go to the GitHub repository "Actions" tab
   - Select "Translate Documentation" workflow
   - Click "Run workflow"
   - Optionally check "Force retranslation" to refresh cached translations
   - Click "Run workflow" to start

2. **What Happens**:
   - Builds English documentation with mkdocs
   - Extracts translatable content from API documentation
   - Translates text using MyMemory API (with caching)
   - Applies translations to Chinese documentation
   - Rebuilds documentation with translations
   - Commits changes automatically

### Automatic Integration

The translation system integrates with the existing documentation workflow:

- When building docs normally, if translation cache exists, translations are automatically applied
- No manual intervention needed for regular documentation updates
- Falls back gracefully if translation files are missing

## Files Created

```
├── .github/workflows/translate.yml    # Translation CI workflow
├── scripts/translate_docs.py          # Main translation script
├── scripts/test_translation.py       # Test script for verification
├── docs/translations/
│   ├── README.md                      # Documentation for translation system
│   └── api_translations.json         # Translation cache (auto-updated)
└── pyproject.toml                     # Updated with translation dependencies
```

## Translation Cache

The system uses `docs/translations/api_translations.json` to cache translations:

```json
{
  "Parameters": "参数",
  "Returns": "返回", 
  "Raises": "抛出异常",
  "Example": "示例",
  "Attributes": "属性",
  "Description": "描述"
}
```

### Benefits of Caching:
- Avoids redundant API calls (faster, respects rate limits)
- Allows manual correction of poor translations
- Preserves good translations across rebuilds

## Manual Translation Editing

You can improve translations manually:

1. Edit `docs/translations/api_translations.json` directly
2. Commit changes to the repository
3. Next documentation build will use your improved translations

For large-scale retranslation:
1. Run workflow with "Force retranslation" checked
2. Review and edit the results in the cache file
3. Commit improved translations

## Technical Details

### Translation Process:
1. **Extract**: Parse HTML to find translatable content (paragraphs, section titles, table descriptions)
2. **Filter**: Skip already translated text (contains Chinese characters) and cached entries
3. **Translate**: Use MyMemory API with 1.5s rate limiting
4. **Cache**: Save translations to avoid redundant work
5. **Apply**: Replace English text in Chinese documentation with translations

### API Rate Limiting:
- 1.5 second delay between translation requests
- Graceful error handling (falls back to original text)
- Caching minimizes API usage

### Content Types Translated:
- Function/class descriptions (main paragraphs)
- Section titles (Parameters, Returns, Raises, etc.)
- Parameter descriptions in tables
- General documentation text

## Troubleshooting

### Common Issues:

1. **Translation fails**: Check internet connectivity and MyMemory API availability
2. **Poor translations**: Edit cache file manually with better translations
3. **Missing translations**: Run workflow with "Force retranslation" option
4. **Build failures**: Check that dependencies are properly installed

### Debugging:

Run the test script to verify setup:
```bash
poetry run python scripts/test_translation.py
```

Check translation functionality:
```bash
poetry run mkdocs build
poetry run python scripts/translate_docs.py
```

## Dependencies

Added to `pyproject.toml`:
- `translate ^3.6.1` - Translation API client
- `beautifulsoup4 ^4.13.4` - HTML parsing

## Integration with Existing Workflow

The translation system enhances the existing documentation workflow:

- **Normal builds**: Automatically apply cached translations if available
- **Translation builds**: Full translation with API calls and cache updates
- **Versioned docs**: Works with mike for versioned documentation
- **GitHub Pages**: Deploys translated documentation automatically

## Future Improvements

Potential enhancements:
1. Support for other languages (Japanese, Korean, etc.)
2. Translation quality scoring and validation
3. Integration with professional translation services
4. Automated translation on documentation changes
5. Translation memory for consistent terminology

---

The translation system is now ready for use! Run the "Translate Documentation" workflow to generate Chinese translations of your API documentation.